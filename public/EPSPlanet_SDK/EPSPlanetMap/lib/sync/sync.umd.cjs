(function(a,r){typeof exports=="object"&&typeof module<"u"?r(exports,require("ol"),require("ol/proj"),require("ol/Observable.js"),require("ol/source/Vector"),require("ol/layer/Vector"),require("ol/geom")):typeof define=="function"&&define.amd?define(["exports","ol","ol/proj","ol/Observable.js","ol/source/Vector","ol/layer/Vector","ol/geom"],r):(a=typeof globalThis<"u"?globalThis:a||self,r(a.Sync={},a.ol,a.ol.proj,a.ol.Observable,a.ol.source.Vector,a.ol.layer.Vector,a.ol.geom))})(this,function(a,r,d,P,ut,Lt,Ht){var j,M,V,y,T,S,O,J,Pt,Q,Vt,X,yt,q,w,R,A,W,L,D,Y,Ot,Z,Rt,$,Wt,I,Dt,H,pt,tt,_t,et,kt,it,Nt,x,ft,nt,Ut,st,jt,z,_,ot,b,k,B,at,Tt,F,Ct,G,vt,f,rt,N,ct,qt,lt,At;"use strict";var Qt=Object.defineProperty;var Xt=(a,r,d)=>r in a?Qt(a,r,{enumerable:!0,configurable:!0,writable:!0,value:d}):a[r]=d;var U=(a,r,d)=>(Xt(a,typeof r!="symbol"?r+"":r,d),d),mt=(a,r,d)=>{if(!r.has(a))throw TypeError("Cannot "+d)};var n=(a,r,d)=>(mt(a,r,"read from private field"),d?d.call(a):r.get(a)),o=(a,r,d)=>{if(r.has(a))throw TypeError("Cannot add the same private member more than once");r instanceof WeakSet?r.add(a):r.set(a,d)},h=(a,r,d,P)=>(mt(a,r,"write to private field"),P?P.call(a,d):r.set(a,d),d),St=(a,r,d,P)=>({set _(ut){h(a,r,ut,d)},get _(){return n(a,r,P)}}),u=(a,r,d)=>(mt(a,r,"access private method"),d);function p(C){return C*180/Math.PI}function v(C){return C*Math.PI/180}function xt(C){const t=90.7142857142857,e=1e3/25.4;return C*e*t}class zt{constructor(t,e,i){o(this,J);o(this,Q);o(this,X);o(this,j,void 0);o(this,M,void 0);o(this,V,!1);o(this,y,null);U(this,"enable",!0);o(this,T,void 0);o(this,S,void 0);o(this,O,"EPSG:4326");U(this,"graphics",{add:({geometry:t,symbol:e})=>{console.log(t),console.log(e);let i=new r.Feature({geometry:new Ht.Polygon(t).transform(n(this,O),n(this,S)),symbol:e});const s=new ut,l=new Lt({source:s,style:{"fill-color":"rgba(255, 255, 255, 0.2)","stroke-color":"#ffcc33","stroke-width":2,"circle-radius":7,"circle-fill-color":"#ffcc33"}});n(this,M).addLayer(l),s.addFeature(i)},remove:u(this,Q,Vt),removeAll:u(this,X,yt)});h(this,j,e),h(this,M,t),h(this,T,i),h(this,y,t.getView().on("propertychange",()=>u(this,J,Pt).call(this))),h(this,S,n(this,M).getView().getProjection())}get id(){return n(this,j)}get syncInfo(){const t=n(this,M).getView();if(!t)return;const e=t.getCenter();if(e==null)return;let i=t.getResolution()||1;const s=t.getProjection().getMetersPerUnit()??1;i=i*s;const l=d.transform(e,n(this,S),n(this,O)),c=p(t.getRotation());return{resolution:i,rotation:c,tilt:null,longitude:l[0],latitude:l[1]}}update(t){if(!t)return;h(this,V,!0);const e=n(this,M).getView();let i=e.getProjection().getMetersPerUnit()??1;const s=d.transform([t.longitude,t.latitude],n(this,O),n(this,S));e.setCenter(s);const l=t.resolution/i,c=e.getResolution()||1;Math.abs(l-c)/c>.01&&e.setResolution(l);const m=v(t.rotation);Math.abs(m-e.getRotation())>.01&&e.setRotation(m),h(this,V,!1)}destroy(){P.unByKey(n(this,y)),h(this,y,null)}}j=new WeakMap,M=new WeakMap,V=new WeakMap,y=new WeakMap,T=new WeakMap,S=new WeakMap,O=new WeakMap,J=new WeakSet,Pt=function(){!this.enable||n(this,V)||n(this,T).call(this,this)},Q=new WeakSet,Vt=function(t){console.log(t)},X=new WeakSet,yt=function(){};class Bt{constructor(t,e,i){o(this,Y);o(this,Z);o(this,$);o(this,I);o(this,H);o(this,tt);o(this,et);o(this,it);o(this,x);o(this,nt);o(this,st);o(this,q,void 0);o(this,w,void 0);o(this,R,[]);U(this,"enable",!0);o(this,A,void 0);o(this,W,!1);o(this,L,void 0);o(this,D,0);h(this,q,e),h(this,w,t),h(this,L,i);let s=t.scene.preRender.addEventListener(()=>{n(this,W)&&u(this,x,ft).call(this)}),l=t.camera.moveStart.addEventListener(()=>{h(this,W,this.enable)}),c=t.camera.moveEnd.addEventListener(()=>{h(this,W,!1)});h(this,R,[s,l,c])}get id(){return n(this,q)}get syncInfo(){if(n(this,w).scene.mode===window.Cesium.SceneMode.SCENE3D)return u(this,$,Wt).call(this);if(n(this,w).scene.mode===window.Cesium.SceneMode.SCENE2D)return u(this,Y,Ot).call(this);if(n(this,w).scene.mode===window.Cesium.SceneMode.COLUMBUS_VIEW)return u(this,Z,Rt).call(this)}update(t){if(t){switch(n(this,w).scene.mode){case window.Cesium.SceneMode.SCENE3D:u(this,it,Nt).call(this,t);break;case window.Cesium.SceneMode.SCENE2D:u(this,tt,_t).call(this,t);break;case window.Cesium.SceneMode.COLUMBUS_VIEW:u(this,et,kt).call(this,t);break}u(this,x,ft).call(this,!0)}}destroy(){n(this,R).forEach(t=>{t()}),h(this,R,[])}}q=new WeakMap,w=new WeakMap,R=new WeakMap,A=new WeakMap,W=new WeakMap,L=new WeakMap,D=new WeakMap,Y=new WeakSet,Ot=function(){const t=n(this,w).scene,e=t.canvas,i=t.camera.positionCartographic,s=(i==null?void 0:i.latitude)||0,l=(i==null?void 0:i.longitude)||0;return{resolution:i.height/e.clientWidth,rotation:0,tilt:0,longitude:p(l),latitude:p(s)}},Z=new WeakSet,Rt=function(){const t=n(this,w).scene,e=t.canvas,i=u(this,H,pt).call(this,t);let s;i?s=window.Cesium.Cartographic.fromCartesian(i):s=t.camera.positionCartographic;let l=t.camera.positionCartographic.height;l=l/Math.sin(Math.abs(t.camera.pitch));const c=(s==null?void 0:s.latitude)||0,m=(s==null?void 0:s.longitude)||0,g=l/e.clientWidth,E=t.camera.pitch+window.Cesium.Math.PI_OVER_TWO;return{resolution:g,rotation:-p(t.camera.heading),tilt:p(E),longitude:p(m),latitude:p(c)}},$=new WeakSet,Wt=function(){const t=n(this,w).scene,e=window.Cesium.Ellipsoid.WGS84,i=u(this,H,pt).call(this,t);let s,l,c=i;if(c){const gt=t.camera.up,K=t.camera.right,wt=new window.Cesium.Cartesian3(-c.y,c.x,0),Mt=window.Cesium.Cartesian3.angleBetween(K,wt);s=window.Cesium.Cartesian3.cross(c,gt,new window.Cesium.Cartesian3).z<0?Mt:-Mt;const Jt=t.camera.position,bt=new window.Cesium.Cartesian3;e.geocentricSurfaceNormal(c,bt);const ht=new window.Cesium.Cartesian3;window.Cesium.Cartesian3.subtract(Jt,c,ht),window.Cesium.Cartesian3.normalize(ht,ht);const Et=Math.acos(window.Cesium.Cartesian3.dot(bt,ht));l=isNaN(Et)?0:Et}else{const gt=t.globe,K=t.camera.positionCartographic.clone(),wt=gt.getHeight(K);K.height=wt||0,c=window.Cesium.Ellipsoid.WGS84.cartographicToCartesian(K),s=t.camera.heading,l=t.camera.pitch+window.Cesium.Math.PI_OVER_TWO}const m=window.Cesium.Cartesian3.distance(c,t.camera.position),g=e.cartesianToCartographic(c),E=(g==null?void 0:g.latitude)||0,dt=(g==null?void 0:g.longitude)||0,Kt=u(this,st,jt).call(this,m,E,t);return h(this,D,l),{resolution:Kt,rotation:p(s),tilt:p(l),longitude:p(dt),latitude:p(E)}},I=new WeakSet,Dt=function(t,e){const i=t.camera.getPickRay(e);return t.globe.pick(i,t)||t.camera.pickEllipsoid(e)},H=new WeakSet,pt=function(t){const e=t.canvas,i=new window.Cesium.Cartesian2(e.clientWidth/2,e.clientHeight/2);return u(this,I,Dt).call(this,t,i)},tt=new WeakSet,_t=function(t){const e=n(this,w).scene,i=e.canvas,s=t.resolution*i.clientWidth;e.camera.setView({destination:window.Cesium.Cartesian3.fromDegrees(t.longitude,t.latitude,s)})},et=new WeakSet,kt=function(t){const e=n(this,w).scene,i=e.canvas,s=t.tilt===null?e.camera.pitch:v(t.tilt-90);let l=Math.abs(s);const c=t.resolution*i.clientWidth/Math.sin(l),m=-v(t.rotation),g=window.Cesium.Cartesian3.fromDegrees(t.longitude,t.latitude,c);e.camera.setView({destination:g,orientation:{heading:m,pitch:s,roll:void 0}}),e.camera.moveDown(c*Math.cos(l))},it=new WeakSet,Nt=function(t){const e=n(this,w).scene,i=new window.Cesium.Cartographic(v(t.longitude),v(t.latitude));if(e.globe){const E=e.globe.getHeight(i);i.height=E||0}const s=window.Cesium.Ellipsoid.WGS84.cartographicToCartesian(i),l=-v(t.rotation),c=t.tilt===null?n(this,D)-window.Cesium.Math.PI_OVER_TWO:v(t.tilt-90),m={pitch:c,heading:l,roll:void 0};e.camera.setView({destination:s,orientation:m});const g=u(this,nt,Ut).call(this,t.resolution,v(t.latitude),e);h(this,D,c+window.Cesium.Math.PI_OVER_TWO),e.camera.moveBackward(g)},x=new WeakSet,ft=function(t=!1){const e=n(this,A),i=n(this,w).camera.viewMatrix;(!e||!window.Cesium.Matrix4.equalsEpsilon(e,i,1e-5))&&(h(this,A,i.clone()),t!==!0&&n(this,L).call(this,this))},nt=new WeakSet,Ut=function(t,e,i){const s=i.canvas;let c=i.camera.frustum.fovy;console.assert(!isNaN(c));const m=t*s.clientHeight,g=Math.cos(Math.abs(e));return m*g/2/Math.tan(c/2)},st=new WeakSet,jt=function(t,e,i){const s=i.canvas;let c=i.camera.frustum.fovy||1;console.assert(!isNaN(c));const m=2*t*Math.tan(c/2),g=Math.cos(Math.abs(e));return m/g/s.clientHeight};class Ft{constructor(t,e,i){o(this,at);o(this,F);o(this,G);o(this,z,void 0);o(this,_,void 0);o(this,ot,!1);o(this,b,null);o(this,k,null);U(this,"enable",!0);o(this,B,void 0);h(this,z,e),h(this,_,t),h(this,B,i),h(this,k,t.watch("interacting,animation",s=>{!s||n(this,b)||h(this,b,t.watch("viewpoint",()=>{u(this,at,Tt).call(this)}))}))}get id(){return n(this,z)}get syncInfo(){const t=n(this,_);let e,i=null;u(this,F,Ct).call(this,t)?(e=-t.camera.heading,i=t.camera.tilt):e=t.rotation;const s=t.center.longitude||0,l=t.center.latitude||0;return{resolution:t.resolution,rotation:e,tilt:i,longitude:s,latitude:l}}async update(t){if(!t)return;u(this,G,vt).call(this);const e=n(this,_),i={type:"point",longitude:t.longitude,latitude:t.latitude};e.center=i,e.scale=xt(t.resolution),u(this,F,Ct).call(this,e)?(e.camera.heading=-t.rotation,e.camera.tilt=t.tilt??e.camera.tilt):e.rotation=t.rotation}destroy(){var t;u(this,G,vt).call(this),(t=n(this,k))==null||t.remove(),h(this,k,null)}}z=new WeakMap,_=new WeakMap,ot=new WeakMap,b=new WeakMap,k=new WeakMap,B=new WeakMap,at=new WeakSet,Tt=function(){!this.enable||n(this,ot)||n(this,B).call(this,this)},F=new WeakSet,Ct=function(t){return t.type==="3d"},G=new WeakSet,vt=function(){var t;n(this,b)&&((t=n(this,b))==null||t.remove(),h(this,b,null))};class Gt{constructor(t,e){o(this,ct);o(this,lt);o(this,f,[]);o(this,rt,1);o(this,N,!1);U(this,"graphics",{add:t=>{n(this,f).forEach(e=>{var i;(i=e==null?void 0:e.graphics)==null||i.add(t)})},remove:t=>{n(this,f).forEach(e=>{var i;(i=e==null?void 0:e.graphics)==null||i.remove(t)})},removeAll:()=>{n(this,f).forEach(t=>{var e;(e=t==null?void 0:t.graphics)==null||e.removeAll()})}});this.enable=(e==null?void 0:e.enable)??!0,t.forEach(i=>{this.addMap(i)})}set enable(t){n(this,N)!==t&&h(this,N,t)}get enable(){return n(this,N)}addMap(t){const e=u(this,lt,At).call(this,t),i=St(this,rt)._++,s=new e(t,i,u(this,ct,qt).bind(this));n(this,f).push(s)}removeMap(t){this.enable&&(t.enableSynchronizer=!1)}highlight(t){n(this,f).forEach(e=>{e==null||e.highlight(t)})}unhighlight(t){n(this,f).forEach(e=>{e==null||e.unhighlight(t)})}unHighlightAll(t){n(this,f).forEach(e=>{e==null||e.unhighlight(t)})}}f=new WeakMap,rt=new WeakMap,N=new WeakMap,ct=new WeakSet,qt=function(t){if(!this.enable)return;const e=t.syncInfo;if(!e)return;n(this,f).filter(s=>s.id!==t.id).forEach(s=>{s==null||s.update(e)})},lt=new WeakSet,At=function(t){var e;if(t.ol_uid)return zt;if(t.cesiumWidget)return Bt;if((e=t.map)!=null&&e.basemap)return Ft;throw new Error("cannot get map type")},a.Synchronizer=Gt,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=sync.umd.cjs.map
